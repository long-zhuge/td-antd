---
name: tools
route: /tools
---

import { Playground } from 'docz';
import LinkBtn from '../link-btn';
import countdown from './countdown';

## 如何调用

```
import { tools } from 'td-antd';
const { delay, genNonDuplicateID } = tools;
```

## API

### delay

在指定毫秒数后调用函数，并将附加参数传给函数。

```
delay((text) => {
  console.log(text); // 将打印 'later'
}, 1000, 'later')
```

### genNonDuplicateID

获取指定位数的随机数，随机数中包含字母和数字，默认两位数

```
const id = genNonDuplicateID(2);
```

### getUrlParameter

获取 url 中指定的参数

```
const name = getUrlParameter('name');
```

### getUrlParams

获取 url 中所有的参数

```
const name = getUrlParams();

// { key: value, ... }
```

### momentToString

moment 和 string 之间的转换，默认格式为 YYYY-MM-DD。如果 value 对象是 moment，则会转为 format 的格式日期，反之亦然

```
const time = momentToString(value, format);
```

### toThousands

数字与千位符数字的转化，千位符数字一般用于金融数字展示

```
// 参数
Function(number, decimal)
  number: 一组数字(数字字符串)或者千位符数字字符串
  decimal: 小数点位数。只针对数字转字符串的情况

// demo
toThousands(123456); // "123,456"
toThousands(123456, 2); // "123,456.00"
toThousands('123456.1', 3); // "123,456.100"
toThousands('123,456'); // 123456
```

### objectToString

对象和字符串之间的转化，自动识别

```
objectToString('{ a: 1, b: 2 }'); // { a: 1, b: 2 }
objectToString([1, 2, 3]); // '[1, 2, 3]'
```

### storageWorker

用于数据缓存的获取/设置

```
// get
storageWorker({
  callback(res) {
    console.log(res);
  }
})

// set
storageWorker({
  type: 'set',
  fields: {
    [itemName]: [itemValue]
  },
  callback(res) {
    console.log(res);
  }
})
```

### downloadBlob

二进制流的文件下载

```
downloadBlob({
  url: 'xxxx.json', // 请求地址
  filename: 'xxx.jpg' // 文件名。如果不设置，将会获取 headers 中后端设置的文件名
  body: {}, // 使用 body 后会发送 POST 请求
})
```

### noPassByInfo

手机号/邮箱 的信息脱敏

```
noPassByInfo('13812345678'); // 138****5678
noPassByInfo('13812345678@qq.com') // 138********@qq.com
```

### countdown

倒计时函数

```
countdown({
  defaultCount: 59, // 默认开始的计数
  callback: (nowCount, defaultCount) => {
    // nowCount = 当前计数，defaultCount = 原始计数
    if (nowCount === 0) {
      // 结束后代码
    }
  },
});
```

<Playground>
  {class Example extends React.Component {
    constructor(props) {
      this.state = {
        count: 10,
        start: false,
      };
    }

    render () {
      const { count, start } = this.state;
      if (start) {
        return `${count}s`;
      }
      return (
        <LinkBtn
          onClick={() => {
            this.setState({ start: true });
            countdown({
              defaultCount: count,
              callback: (nowCount, defaultCount) => {
                this.setState({ count: nowCount });
                if (nowCount === 0) {
                  this.setState({
                    count: defaultCount,
                    start: false,
                  });
                }
              },
            });
          }}
        >
          开始倒计时
        </LinkBtn>
      );
    }
  }}
</Playground>

### redirect

dva.routerRedux.push 的简单封装，实现路由切换。必须配置了 `localConfig` 后才能正常使用。

```
// 路由切换，如切换至：localhost:8080/demo
redirect('/demo', dispatch); // 第二个参数 dispatch 如果不传，将会从全局配置项中获取
```

### isPromise

判断当前对象是否为 promise 对象

```
const promise = new Promise();
isPromise(promise) // true
```